import pandas as pd

# Загрузка данных
piers_path = "Piers.csv"
file_path = "TableTime.csv"

piers_data = pd.read_csv(piers_path)
data = pd.read_csv(file_path)

# Преобразование строковых дат в формат datetime
data['Дата начала действия записи расписания '] = pd.to_datetime(data['Дата начала действия записи расписания '], errors='coerce')
data['Дата окончания действия записи расписания'] = pd.to_datetime(data['Дата окончания действия записи расписания'], errors='coerce')

# Проверка минимальных и максимальных дат
print(f"Минимальная дата начала: {data['Дата начала действия записи расписания '].min()}")
print(f"Максимальная дата окончания: {data['Дата окончания действия записи расписания'].max()}")

# Очистка данных: удаление строк, где даты начала или окончания расписания отсутствуют
data = data[data['Дата начала действия записи расписания '].notna()]
data = data[data['Дата окончания действия записи расписания'].notna()]

# Проверка данных после очистки
print(f"Минимальная дата начала после очистки: {data['Дата начала действия записи расписания '].min()}")
print(f"Максимальная дата окончания после очистки: {data['Дата окончания действия записи расписания'].max()}")

# Фильтрация данных по диапазону дат: оставляем записи, которые находятся в пределах действующего расписания
current_date = pd.to_datetime("2024-10-01")  # Например, текущая дата для фильтрации
data_filtered = data[(data['Дата начала действия записи расписания '] <= current_date) &
                     (data['Дата окончания действия записи расписания'] >= current_date)]

# Проверка результатов фильтрации
print(f"Количество записей после фильтрации: {data_filtered.shape[0]}")

# Сохранение очищенного и отфильтрованного датасета
data_filtered.to_csv("filtered_schedule_data.csv", index=False)

print("Данные успешно очищены и отфильтрованы.")
